<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MBFA Benchmark Results â€” Build #BUILD_NUM_PLACEHOLDER</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: #0d1117; color: #e6edf3; padding: 32px 24px; }
    .container { max-width: 1100px; margin: 0 auto; }
    header { border-bottom: 2px solid #f78166; padding-bottom: 20px; margin-bottom: 32px; }
    header h1 { font-size: 2rem; color: #f78166; }
    header h1 span { color: #e6edf3; }
    .meta { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 12px; }
    .meta-item { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 6px 14px; font-size: 0.85rem; }
    .meta-item strong { color: #79c0ff; }
    .banner { background: #0f2a1a; border: 1px solid #2ea043; border-radius: 8px; padding: 14px 20px; margin-bottom: 28px; color: #3fb950; font-weight: 600; }
    .banner.fail { background: #2a0f0f; border-color: #f85149; color: #f85149; }
    .toolbar { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-bottom: 12px; }
    .copy-btn { background: #21262d; border: 1px solid #30363d; color: #e6edf3; padding: 7px 16px; border-radius: 6px; font-size: 0.82rem; cursor: pointer; display: flex; align-items: center; gap: 7px; transition: background 0.15s, border-color 0.15s; }
    .copy-btn:hover { background: #2d333b; border-color: #8b949e; }
    .copy-btn.copied { background: #0f2a1a; border-color: #2ea043; color: #3fb950; }
    .copy-btn svg { flex-shrink: 0; }
    table { width: 100%; border-collapse: collapse; background: #161b22; border: 1px solid #30363d; border-radius: 8px; overflow: hidden; margin-bottom: 32px; font-size: 0.88rem; }
    thead tr { background: #1c2128; }
    th { padding: 10px 14px; text-align: left; color: #8b949e; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #30363d; }
    td { padding: 10px 14px; border-bottom: 1px solid #21262d; vertical-align: top; }
    tr:last-child td { border-bottom: none; }
    tbody tr { cursor: pointer; }
    tbody tr:hover td { background: #1c2128; }
    .win  { color: #3fb950; font-weight: 700; }
    .loss { color: #f85149; }
    .tie  { color: #e3b341; }
    .pass { color: #3fb950; font-weight: 600; }
    .fail { color: #f85149; font-weight: 600; }
    .bar-row { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
    .bar { height: 8px; border-radius: 4px; min-width: 2px; }
    .bar-mbfa { background: #f78166; }
    .bar-gzip { background: #79c0ff; }
    .bar-zstd { background: #a371f7; }
    .fold-detail { font-family: monospace; font-size: 0.72rem; color: #8b949e; line-height: 1.6; white-space: pre-wrap; }
    .section-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 12px; border-left: 3px solid #f78166; padding-left: 10px; }
    footer { margin-top: 40px; padding-top: 16px; border-top: 1px solid #30363d; color: #8b949e; font-size: 0.78rem; text-align: center; }
    .legend { display: flex; gap: 18px; margin-bottom: 10px; font-size: 0.8rem; }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    .dot { width: 9px; height: 9px; border-radius: 50%; display: inline-block; }
    .notes { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 18px; font-size: 0.85rem; line-height: 1.8; color: #8b949e; }
    .click-hint { font-size: 0.72rem; color: #484f58; margin-bottom: 10px; }

    /* Modal */
    .modal-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.72); z-index: 1000;
      align-items: center; justify-content: center; padding: 20px;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: #161b22; border: 1px solid #30363d; border-radius: 12px;
      width: 100%; max-width: 680px; max-height: 90vh;
      display: flex; flex-direction: column; overflow: hidden;
      box-shadow: 0 24px 64px rgba(0,0,0,0.6);
      animation: modal-in 0.18s ease;
    }
    @keyframes modal-in { from { transform: translateY(18px); opacity: 0; } to { transform: none; opacity: 1; } }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 22px; border-bottom: 1px solid #30363d; flex-shrink: 0;
    }
    .modal-title { font-size: 1.1rem; font-weight: 700; color: #f78166; }
    .modal-subtitle { font-size: 0.78rem; color: #8b949e; margin-top: 3px; }
    .modal-close {
      background: #21262d; border: 1px solid #30363d; color: #8b949e;
      width: 32px; height: 32px; border-radius: 6px; font-size: 1.1rem;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: background 0.15s, color 0.15s; flex-shrink: 0;
    }
    .modal-close:hover { background: #2d333b; color: #e6edf3; }
    .modal-body { padding: 22px; overflow-y: auto; display: flex; flex-direction: column; gap: 22px; }
    .modal-section-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.8px; color: #484f58; font-weight: 600; margin-bottom: 10px; }
    .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .stat-card { background: #0d1117; border: 1px solid #21262d; border-radius: 8px; padding: 12px 14px; }
    .stat-card .stat-label { font-size: 0.72rem; color: #8b949e; margin-bottom: 4px; }
    .stat-card .stat-value { font-size: 1.05rem; font-weight: 700; }
    .stat-card .stat-sub { font-size: 0.72rem; color: #484f58; margin-top: 2px; }
    .cmp-row { display: flex; flex-direction: column; gap: 8px; }
    .cmp-item { display: grid; grid-template-columns: 56px 1fr 64px 68px; align-items: center; gap: 10px; }
    .cmp-label { font-size: 0.78rem; color: #8b949e; }
    .cmp-track { background: #0d1117; border-radius: 4px; height: 10px; overflow: hidden; }
    .cmp-fill { height: 100%; border-radius: 4px; }
    .cmp-pct { font-size: 0.82rem; font-weight: 700; text-align: right; }
    .cmp-bytes { font-size: 0.72rem; color: #484f58; text-align: right; }
    .fold-steps { display: flex; flex-direction: column; gap: 0; }
    .fold-step { display: flex; gap: 14px; align-items: flex-start; padding: 10px 0; border-bottom: 1px solid #21262d; }
    .fold-step:last-child { border-bottom: none; }
    .fold-step-icon { width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 0.72rem; font-weight: 700; margin-top: 1px; }
    .fold-step-icon.origin { background: #1c2128; border: 1px solid #30363d; color: #8b949e; }
    .fold-step-icon.fold   { background: #0f1e3a; border: 1px solid #1f4080; color: #79c0ff; }
    .fold-step-icon.stop   { background: #2a0f0f; border: 1px solid #5a1a1a; color: #f85149; }
    .fold-step-icon.done   { background: #0f2a1a; border: 1px solid #1a5a2a; color: #3fb950; }
    .fold-step-content { flex: 1; }
    .fold-step-title { font-size: 0.85rem; font-weight: 600; color: #e6edf3; }
    .fold-step-detail { font-size: 0.78rem; color: #8b949e; margin-top: 3px; }
    .fold-step-bar-track { background: #0d1117; border-radius: 3px; height: 6px; overflow: hidden; margin-top: 6px; }
    .fold-step-bar-fill { height: 100%; border-radius: 3px; background: #79c0ff; }
    .fold-step-ratio { font-size: 0.7rem; color: #484f58; margin-top: 3px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>&#x1F980; MBFA <span>&#x2014; MidMans Bit Folding Algorithm</span></h1>
      <p style="color:#8b949e;margin-top:6px;">MidManStudio | Benchmark Results</p>
      <div class="meta">
        <div class="meta-item"><strong>Build:</strong> #BUILD_NUM_PLACEHOLDER</div>
        <div class="meta-item"><strong>Branch:</strong> BRANCH_PLACEHOLDER</div>
        <div class="meta-item"><strong>Commit:</strong> COMMIT_PLACEHOLDER</div>
        <div class="meta-item"><strong>Date:</strong> DATE_PLACEHOLDER</div>
      </div>
    </header>

    <div class="banner" id="rt-banner">&#x23F3; Checking roundtrip status...</div>

    <div class="toolbar">
      <div class="section-title" style="margin-bottom:0">Compression Results</div>
      <button class="copy-btn" id="copy-btn">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
          <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
          <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
        </svg>
        Copy results.json
      </button>
    </div>

    <div class="legend">
      <div class="legend-item"><div class="dot" style="background:#f78166"></div>MBFA</div>
      <div class="legend-item"><div class="dot" style="background:#79c0ff"></div>gzip</div>
      <div class="legend-item"><div class="dot" style="background:#a371f7"></div>zstd</div>
    </div>
    <p class="click-hint">&#x1F4A1; Click any row for a detailed breakdown</p>

    <table>
      <thead>
        <tr>
          <th>Dataset</th>
          <th>Original</th>
          <th>MBFA</th>
          <th>gzip</th>
          <th>zstd</th>
          <th>Roundtrip</th>
          <th>Visual</th>
          <th>Fold Detail</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="section-title">About MBFA &#x2014; Conceptual Status</div>
    <div class="notes">
      <p><strong style="color:#e6edf3">What MBFA is:</strong> MidMans Bit Folding Algorithm is a novel multi-fold iterative compression algorithm under active research and development by MidManStudio. The core concept &#x2014; encoding data as an instruction chain where each fold produces a bitstream that reconstructs the previous fold &#x2014; is architecturally distinct from existing published compression algorithms.</p>
      <br>
      <p><strong style="color:#e6edf3">Current implementation status:</strong> This is a research implementation. The algorithm is functionally correct (all roundtrips pass) but not yet optimised for competitive compression ratios on general data. Active work is ongoing on operand encoding (Exp-Golomb replacing Cantor pairing), Move-To-Front transforms between folds, and entropy coding strategies.</p>
      <br>
      <p><strong style="color:#e6edf3">Where MBFA currently wins:</strong> Highly repetitive data &#x2014; the multi-fold convergence dramatically outperforms gzip and zstd by exploiting structure that single-pass algorithms cannot see across their own metadata.</p>
      <br>
      <p><strong style="color:#e6edf3">Known gap:</strong> General prose and source code &#x2014; the flat-cost literal encoding (10 bits per byte regardless of frequency) is the primary bottleneck vs gzip's adaptive Huffman coding. This is a known and addressable limitation being worked on.</p>
      <br>
      <p>Lower % = better compression. 100% = incompressible data correctly passed through with near-zero overhead.</p>
    </div>

    <footer>MidMans Bit Folding Algorithm (MBFA) &#x2014; MidManStudio &#x2014; Build #BUILD_NUM_PLACEHOLDER</footer>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modal-title">Dataset</div>
          <div class="modal-subtitle" id="modal-subtitle"></div>
        </div>
        <button class="modal-close" id="modal-close" aria-label="Close">&#x2715;</button>
      </div>
      <div class="modal-body">
        <div>
          <div class="modal-section-label">Summary</div>
          <div class="stat-grid" id="modal-stats"></div>
        </div>
        <div>
          <div class="modal-section-label">Compression Comparison</div>
          <div class="cmp-row" id="modal-cmp"></div>
        </div>
        <div>
          <div class="modal-section-label">Fold Pipeline</div>
          <div class="fold-steps" id="modal-folds"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let allData = [];

    fetch('results.json')
      .then(r => r.json())
      .then(data => {
        allData = data;
        const tbody = document.getElementById('tbody');
        let allPass = true;
        tbody.innerHTML = '';
        data.forEach((row, idx) => {
          if (row.mbfa_roundtrip !== 'PASS') allPass = false;
          const mbfaWin  = parseFloat(row.mbfa_pct) < parseFloat(row.gzip_pct);
          const mbfaLoss = parseFloat(row.mbfa_pct) > parseFloat(row.gzip_pct);
          const cls   = mbfaWin ? 'win' : mbfaLoss ? 'loss' : 'tie';
          const rtcls = row.mbfa_roundtrip === 'PASS' ? 'pass' : 'fail';
          const scale = v => Math.min(160, Math.round(parseFloat(v) * 1.6));
          const foldLines = row.fold_detail.split('|').filter(Boolean).join('\n');
          const tr = document.createElement('tr');
          tr.dataset.idx = idx;
          tr.innerHTML =
            '<td style="font-weight:600">' + row.dataset.replace(/_/g,' ') + '</td>' +
            '<td>' + (row.original_bytes/1024).toFixed(1) + ' KB</td>' +
            '<td class="' + cls + '">' + row.mbfa_pct + '%<br><span style="color:#8b949e;font-size:0.78rem">' + row.mbfa_ms + 'ms \u2022 ' + row.mbfa_bytes + 'B</span></td>' +
            '<td>' + row.gzip_pct + '%<br><span style="color:#8b949e;font-size:0.78rem">' + row.gzip_ms + 'ms \u2022 ' + row.gzip_bytes + 'B</span></td>' +
            '<td style="color:#a371f7">' + row.zstd_pct + '%<br><span style="color:#8b949e;font-size:0.78rem">' + row.zstd_ms + 'ms \u2022 ' + row.zstd_bytes + 'B</span></td>' +
            '<td class="' + rtcls + '">' + row.mbfa_roundtrip + '</td>' +
            '<td>' +
              '<div class="bar-row"><div class="bar bar-mbfa" style="width:' + scale(row.mbfa_pct) + 'px"></div><span style="font-size:0.78rem;color:#f78166">' + row.mbfa_pct + '%</span></div>' +
              '<div class="bar-row"><div class="bar bar-gzip" style="width:' + scale(row.gzip_pct) + 'px"></div><span style="font-size:0.78rem;color:#79c0ff">' + row.gzip_pct + '%</span></div>' +
              '<div class="bar-row"><div class="bar bar-zstd" style="width:' + scale(row.zstd_pct) + 'px"></div><span style="font-size:0.78rem;color:#a371f7">' + row.zstd_pct + '%</span></div>' +
            '</td>' +
            '<td><div class="fold-detail">' + foldLines + '</div></td>';
          tr.addEventListener('click', function() { openModal(idx); });
          tbody.appendChild(tr);
        });
        const banner = document.getElementById('rt-banner');
        if (allPass) {
          banner.textContent = '\u2705 All roundtrip tests passed \u2014 compress \u2192 decompress = exact original bytes';
        } else {
          banner.className = 'banner fail';
          banner.textContent = '\u274C One or more roundtrip tests FAILED \u2014 check fold detail column';
        }
      })
      .catch(function(e) {
        document.getElementById('tbody').innerHTML =
          '<tr><td colspan="8" style="color:#f85149;text-align:center;padding:20px">Failed to load results.json: ' + e + '</td></tr>';
      });

    document.getElementById('copy-btn').addEventListener('click', function() {
      var btn = document.getElementById('copy-btn');
      navigator.clipboard.writeText(JSON.stringify(allData, null, 2)).then(function() {
        btn.classList.add('copied');
        btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 1.06-1.06L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg> Copied!';
        setTimeout(function() {
          btn.classList.remove('copied');
          btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg> Copy results.json';
        }, 2000);
      });
    });

    function fmtBytes(n) {
      return n >= 1024 ? (n/1024).toFixed(1) + ' KB' : n + ' B';
    }
    function fmtPct(p) {
      var v = parseFloat(p);
      var color = v < 50 ? '#3fb950' : v < 80 ? '#e3b341' : v < 100 ? '#f85149' : '#8b949e';
      return { text: p + '%', color: color };
    }
    function parseFolds(detail) {
      return detail.split('|').filter(Boolean).map(function(l) { return l.trim(); });
    }

    function openModal(idx) {
      var row = allData[idx];
      document.getElementById('modal-title').textContent = row.dataset.replace(/_/g, ' ');
      document.getElementById('modal-subtitle').textContent =
        fmtBytes(row.original_bytes) + ' original  \u2022  roundtrip: ' + row.mbfa_roundtrip;

      var mbfaPct  = fmtPct(row.mbfa_pct);
      var saved    = row.original_bytes - row.mbfa_bytes;
      var savedPct = ((saved / row.original_bytes) * 100).toFixed(1);
      var lines    = parseFolds(row.fold_detail);
      var keptFolds = lines.filter(function(l) {
        return /^Fold \d/.test(l) && !l.includes('not worth');
      }).length;
      var totalAttempted = lines.filter(function(l) {
        return /^Fold \d/.test(l);
      }).length;
      var vsGzip = parseFloat(row.mbfa_pct) < parseFloat(row.gzip_pct) ? '\u2713 Wins'
                 : parseFloat(row.mbfa_pct) === parseFloat(row.gzip_pct) ? 'Tie' : '\u2717 Loses';
      var vsColor = parseFloat(row.mbfa_pct) < parseFloat(row.gzip_pct) ? '#3fb950' : '#f85149';

      document.getElementById('modal-stats').innerHTML =
        '<div class="stat-card"><div class="stat-label">MBFA Size</div><div class="stat-value" style="color:' + mbfaPct.color + '">' + mbfaPct.text + '</div><div class="stat-sub">' + fmtBytes(row.mbfa_bytes) + '</div></div>' +
        '<div class="stat-card"><div class="stat-label">Space Saved</div><div class="stat-value" style="color:#3fb950">' + (saved > 0 ? savedPct + '%' : '\u2014') + '</div><div class="stat-sub">' + (saved > 0 ? fmtBytes(saved) + ' freed' : 'no saving') + '</div></div>' +
        '<div class="stat-card"><div class="stat-label">Encode Time</div><div class="stat-value">' + row.mbfa_ms + 'ms</div><div class="stat-sub">release build</div></div>' +
        '<div class="stat-card"><div class="stat-label">Folds Used</div><div class="stat-value" style="color:#79c0ff">' + keptFolds + '</div><div class="stat-sub">' + (totalAttempted > keptFolds ? totalAttempted + ' attempted' : 'all kept') + '</div></div>' +
        '<div class="stat-card"><div class="stat-label">Roundtrip</div><div class="stat-value" style="color:' + (row.mbfa_roundtrip === 'PASS' ? '#3fb950' : '#f85149') + '">' + row.mbfa_roundtrip + '</div><div class="stat-sub">compress \u2192 decompress</div></div>' +
        '<div class="stat-card"><div class="stat-label">vs gzip</div><div class="stat-value" style="color:' + vsColor + '">' + vsGzip + '</div><div class="stat-sub">gzip: ' + row.gzip_pct + '%</div></div>';

      var maxPct = Math.max(parseFloat(row.mbfa_pct), parseFloat(row.gzip_pct), parseFloat(row.zstd_pct), 10);
      function bar(pct, color) {
        var w = Math.min(100, (parseFloat(pct) / maxPct) * 100).toFixed(1);
        return '<div class="cmp-track"><div class="cmp-fill" style="width:' + w + '%;background:' + color + '"></div></div>';
      }
      document.getElementById('modal-cmp').innerHTML =
        '<div class="cmp-item"><div class="cmp-label" style="color:#f78166">MBFA</div>' + bar(row.mbfa_pct,'#f78166') + '<div class="cmp-pct" style="color:#f78166">' + row.mbfa_pct + '%</div><div class="cmp-bytes">' + fmtBytes(row.mbfa_bytes) + ' \u2022 ' + row.mbfa_ms + 'ms</div></div>' +
        '<div class="cmp-item"><div class="cmp-label" style="color:#79c0ff">gzip</div>' + bar(row.gzip_pct,'#79c0ff') + '<div class="cmp-pct" style="color:#79c0ff">' + row.gzip_pct + '%</div><div class="cmp-bytes">' + fmtBytes(row.gzip_bytes) + ' \u2022 ' + row.gzip_ms + 'ms</div></div>' +
        '<div class="cmp-item"><div class="cmp-label" style="color:#a371f7">zstd</div>' + bar(row.zstd_pct,'#a371f7') + '<div class="cmp-pct" style="color:#a371f7">' + row.zstd_pct + '%</div><div class="cmp-bytes">' + fmtBytes(row.zstd_bytes) + ' \u2022 ' + row.zstd_ms + 'ms</div></div>';

      var origBits = 0;
      var stepsHtml = '';
      lines.forEach(function(line) {
        if (line.startsWith('Original')) {
          var m = line.match(/([\d]+) bits \(([\d]+) bytes\)/);
          if (m) origBits = parseInt(m[1]);
          stepsHtml += '<div class="fold-step"><div class="fold-step-icon origin">\u2193</div><div class="fold-step-content"><div class="fold-step-title">Original Data</div><div class="fold-step-detail">' + line.replace('Original size: ','') + '</div></div></div>';
        } else if (/^Fold \d/.test(line) && !line.includes('not worth')) {
          var mN = line.match(/Fold (\d+) \((\w+)\)/);
          var mS = line.match(/([\d]+) bits \(([\d]+) bytes\)/);
          var fb = mS ? parseInt(mS[1]) : 0;
          var ratio = origBits > 0 ? ((fb / origBits) * 100).toFixed(1) : '0';
          var barW  = origBits > 0 ? Math.min(100, (fb / origBits) * 100).toFixed(1) : 0;
          stepsHtml += '<div class="fold-step"><div class="fold-step-icon fold">F' + (mN ? mN[1] : '?') + '</div><div class="fold-step-content"><div class="fold-step-title">Fold ' + (mN ? mN[1] : '?') + ' \u2014 ' + (mN ? mN[2] : '') + '</div><div class="fold-step-detail">' + (mS ? mS[1] + ' bits (' + mS[2] + ' bytes)' : line) + '</div><div class="fold-step-bar-track"><div class="fold-step-bar-fill" style="width:' + barW + '%"></div></div><div class="fold-step-ratio">' + ratio + '% of original</div></div></div>';
        } else if (line.includes('not worth')) {
          stepsHtml += '<div class="fold-step"><div class="fold-step-icon stop">\u2717</div><div class="fold-step-content"><div class="fold-step-title" style="color:#f85149">Fold rejected</div><div class="fold-step-detail">' + line + '</div></div></div>';
        } else if (line.startsWith('Done')) {
          stepsHtml += '<div class="fold-step"><div class="fold-step-icon done">\u2713</div><div class="fold-step-content"><div class="fold-step-title" style="color:#3fb950">Final output</div><div class="fold-step-detail">' + line + '</div></div></div>';
        }
      });
      document.getElementById('modal-folds').innerHTML = stepsHtml;

      document.getElementById('modal-overlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('modal-overlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    document.getElementById('modal-close').addEventListener('click', closeModal);
    document.getElementById('modal-overlay').addEventListener('click', function(e) {
      if (e.target === document.getElementById('modal-overlay')) closeModal();
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeModal();
    });
  </script>
</body>
  </html>
